<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bone Position Fixer</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; display: flex; }
        #viewer { flex: 1; height: 100vh; }
        #controls { width: 350px; background: #252525; padding: 20px; overflow-y: auto; height: 100vh; border-left: 1px solid #444; }
        .control-group { margin-bottom: 20px; padding: 10px; background: #333; border-radius: 8px; }
        label { display: block; font-size: 12px; color: #ff69b4; margin-bottom: 5px; }
        input[type=range] { width: 100%; margin-bottom: 10px; }
        button { width: 100%; padding: 10px; background: #ff69b4; border: none; color: white; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #ff85c2; }
        textarea { width: 100%; height: 100px; background: #111; color: #0f0; border: 1px solid #444; margin-top: 10px; font-family: monospace; font-size: 11px; }
    </style>
</head>
<body>

    <div id="viewer"></div>

    <div id="controls">
        <h2>Bone Fixer</h2>
        <p style="font-size: 11px; color: #aaa;">Adjust sliders to fix the arms. Copy the code below when done.</p>
        
        <div class="control-group">
            <strong>Left Arm (J_Bip_L_UpperArm)</strong>
            <label>Rotate X</label><input type="range" id="lx" min="-3.14" max="3.14" step="0.01" value="0">
            <label>Rotate Y</label><input type="range" id="ly" min="-3.14" max="3.14" step="0.01" value="0">
            <label>Rotate Z</label><input type="range" id="lz" min="-3.14" max="3.14" step="0.01" value="0">
        </div>

        <div class="control-group">
            <strong>Right Arm (J_Bip_R_UpperArm)</strong>
            <label>Rotate X</label><input type="range" id="rx" min="-3.14" max="3.14" step="0.01" value="0">
            <label>Rotate Y</label><input type="range" id="ry" min="-3.14" max="3.14" step="0.01" value="0">
            <label>Rotate Z</label><input type="range" id="rz" min="-3.14" max="3.14" step="0.01" value="0">
        </div>

        <button onclick="copyData()">Copy Bone Data</button>
        <textarea id="output" readonly placeholder="Your bone data will appear here..."></textarea>
    </div>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';
    import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';

    let scene, camera, renderer, controls, model;
    let bones = {};

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(25, (window.innerWidth - 350) / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 5);

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth - 350, window.innerHeight);
        document.getElementById('viewer').appendChild(renderer.domElement);

        controls = new OrbitControls(camera, renderer.domElement);
        scene.add(new THREE.AmbientLight(0xffffff, 1.5));

        const loader = new GLTFLoader();
        loader.load('/assets/character.glb', (gltf) => {
            model = gltf.scene;
            
            // Auto center
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            model.position.sub(center);
            
            model.traverse(n => {
                if (n.isBone) {
                    if (n.name === "J_Bip_L_UpperArm") bones.left = n;
                    if (n.name === "J_Bip_R_UpperArm") bones.right = n;
                }
            });
            scene.add(model);
        });

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        if (bones.left) {
            bones.left.rotation.x = document.getElementById('lx').value;
            bones.left.rotation.y = document.getElementById('ly').value;
            bones.left.rotation.z = document.getElementById('lz').value;
        }
        if (bones.right) {
            bones.right.rotation.x = document.getElementById('rx').value;
            bones.right.rotation.y = document.getElementById('ry').value;
            bones.right.rotation.z = document.getElementById('rz').value;
        }
        renderer.render(scene, camera);
        updateText();
    }

    function updateText() {
        const data = {
            L_Arm: [document.getElementById('lx').value, document.getElementById('ly').value, document.getElementById('lz').value],
            R_Arm: [document.getElementById('rx').value, document.getElementById('ry').value, document.getElementById('rz').value]
        };
        document.getElementById('output').value = JSON.stringify(data);
    }

    window.copyData = () => {
        const copyText = document.getElementById("output");
        copyText.select();
        document.execCommand("copy");
        alert("Copied to clipboard!");
    }

    init();
</script>
</body>
</html>